
```{r captions_setup}

plot_israel_us_cap = paste0("Correlation of banking integration and ",
                            "financial synchronization ",
                            "(netting fixed effects and controls).",
                            " \\label{plot_israel_us}")

```


```{r plot_uk_bank_linkages,fig.cap="UK's cross border credit\\label{plot_uk_bank_linkages}", fig.pos="h", out.extra=""}

net_df = raw_data$bis_lbs %>%
  filter(grepl("United_Kingdom",CountryPair)) %>%
  filter(Date == as.yearqtr("2018 Q4")) %>%
  select(CountryPair, Balance) %>%
  group_by(CountryPair) %>%
  summarise(Balance = mean(Balance, na.rm = TRUE) * 10 ^ (-3)) %>%
  ungroup() %>%
  mutate(CountryPair = str_remove_all(CountryPair,"United_Kingdom")) %>%
  mutate(CountryPair = str_remove_all(CountryPair,"-")) %>%
  mutate(CountryPair = str_replace_all(CountryPair,"_"," ")) %>%
  rename(Country = CountryPair)


ggplot(net_df, aes(x = reorder(Country, Balance), y = Balance)) +
  geom_bar(stat = "identity") +
  scale_y_continuous(label = comma) +
  labs(x = "", y = "Total cross border bilateral credit (USD billions)",
       title = paste("United Kingdoms total cross border bilateral credit",
                     " counterparties in 2018 Q4")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_flip()


```



```{r plot_us_uk_cycles, fig.cap="Israel and US financial cycles\\label{plot_us_uk_cycles}", fig.pos="h", out.extra=""}

ggplot(country_df %>%
         select(Date, Country, Fin_ret) %>%
         filter(Country %in% c("United_Kingdom","United_States")) %>%
         filter(Date >= 1995),
       aes(x = Date, y = Fin_ret * 100, color = Country, group = Country)) +
  geom_line() +
  labs(x = "", y = "Rate of change (YoY)",
       title = paste0("Synchronization of United_States and",
                      " United_Kingdom financial activity")) +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, vjust = 0.5))

```



Figure \ref{plot_israel_us} shows the correlation between financial
synchronization and banking integration for Israel - United States pair
(the United States was the largest Israel's counterpart in 2018). To
control for the effect of other factors I first regress financial
synchronization and banking integration on control variables set (including
fixed effect). The figure plots the residuals of this first step regressions, the trend line shows the negative association between financial synchronization and banking integration in the Israel-United States country pair.

```{r plot_us_uk,fig.cap=plot_israel_us_cap, fig.pos="H", out.extra=""}

bank_clean = plm(sub("Fin_synch","bank_gdp",
                     gsub("lag(bank_gdp,1) *","",reg_formula, fixed = TRUE),
                     fixed = TRUE),
                 data = fin_reg_df, index = c("CountryPair","Date"),
                 model = "within", effect = "twoways")

synch_clean = plm(gsub("lag(bank_gdp,1) *","",reg_formula, fixed = TRUE),
                  data = fin_reg_df, index = c("CountryPair","Date"),
                  model = "within", effect = "twoways")

df_clean = list(bank_clean$model$CountryPair,
                bank_clean$residuals, synch_clean$residuals) %>%
  reduce(cbind.data.frame) %>%
  setNames(c("CountryPair","Bank","FinSynch"))

ggplot(df_clean %>%
         filter(CountryPair == "United_Kingdom-United_States"),
       aes(x = Bank, y = FinSynch)) +
  geom_point() +
  labs(x = "Banking integration (log of bank credit to gdp)",
       y = "Financial synchronization (percent)",
       title = "United States - United Kingdom \n (netting fixed effects and controls)") +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

```

The effect of banking linkages in Israel sub sample is similar to the effect in the total sample. A one standard deviation change in banking linkages reduces the synchronization by `r abs(round(coef_vec[names(coef_vec) == "lag(bank_gdp, 1)"] * sd_ratio_isr,2))` standard deviations.



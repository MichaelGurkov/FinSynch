---
title: "Financial cycles synchronization and financial integration"
subtitle: 'Preliminary draft'
author: "Michael Gurkov"
fontsize: 11pt
output:
  rmarkdown::pdf_document:
    latex_engine: xelatex
    number_sections: true
    includes:
            in_header: C:\\Users\\Misha\\Documents\\Financial-Cycle\\GlobalFinancialCycleSynch\\vignettes\\GlobalFinCyclePreambleDoc.tex
abstract: "This paper studies the relationship between financial cycles synchronization and financial integration. My results suggest that the relationship is state depended: I find that financial crises increase the \"shock propagation\" feature of banking integration. This is an important result for policymakers. It suggests that while banking integration may be desired, additional macroprudential measures may be warranted to account for the risk exposure during crisis times."
bibliography: C:\\Users\\Misha\\Documents\\References\\Financial_Cycle-Global_Financial_Cycle.bib

vignette: >
  %\VignetteIndexEntry{CycleSynch}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,echo = FALSE,
  message = FALSE,warning = FALSE,
  comment = "#>"
)
```


```{r load_package}

devtools::load_all()

# library(car)

library(tidyverse)

library(plm)

library(stargazer)
 
# library(sandwich)
# 
# library(clubSandwich)
# 
# library(lmtest)

library(purrr)

# library(igraph)

# library(DescTools)

```


```{r params_setup}

save_temp_status = FALSE

countries_list = list(
  oecd_countries = c("Australia","Austria","Belgium","Canada","Chile",
                  "Czech_Republic","Denmark","Estonia","Finland","France",
                  "Germany","Greece","Hungary", "Iceland","Ireland",
                  "Israel","Italy","Japan","Korea","Latvia",
                  "Lithuania","Luxembourg","Mexico","Netherlands",
                  "New_Zealand","Norway","Poland","Portugal",
                  "Slovak_Republic","Slovenia","Spain","Sweden",
                  "Switzerland","Turkey","United_Kingdom"
                  ,"United_States"),
  strong_countries = c("Australia","Austria","Belgium","Canada",
                  "Switzerland","Germany","Denmark","Spain",
                  "Finland","France","United_Kingdom","Ireland",
                  "Italy","Japan","Netherlands","Portugal",
                  "Sweden","United_States"),
  fsap_countries = c("Austria","Belgium","Germany","Denmark","Spain",
                   "France","Finland","Greece","Ireland","Italy",
                   "Luxembourg","Netherlands","Portugal",
                   "Sweden","United_Kingdom"),
  eu_countries = c("Austria","Belgium","Bulgaria","Croatia","Cyprus",
                   "Czech_Republic","Denmark","Estonia","Finland","France",
                   "Germany","Greece","Hungary","Ireland","Italy",
                   "Latvia","Lithuania","Luxembourg", "Malta","Netherlands",
                   "Poland","Portugal","Romania","Slovak_Republic",
                   "Slovenia","Spain","Sweden","United_Kingdom"),
  euro_countries = c("Austria","Belgium","Cyprus","Estonia","Finland",
                     "France","Germany","Greece","Ireland","Italy",
                     "Latvia","Lithuania","Luxembourg", "Malta",
                     "Netherlands","Portugal","Slovak_Republic",
                     "Slovenia","Spain"))

countries_list$weak_countries = countries_list$oecd_countries[!countries_list$oecd_countries %in% countries_list$strong_countries]


pairs_list = lapply(names(countries_list),
           function(temp_name){
             apply(combn(countries_list[[temp_name]],2), 2,
                   function(temp_col){
                     ifelse(temp_col[1]<temp_col[2],
                            paste(temp_col[1],temp_col[2],sep = "-"),
                            paste(temp_col[2],temp_col[1],sep = "-"))})
  
})

names(pairs_list) = paste(names(countries_list), "pairs", sep = "_")

countries_list = c(countries_list, pairs_list)

rm(pairs_list)

countries_list$cross_country_pairs = countries_list$oecd_countries_pairs[!countries_list$oecd_countries_pairs %in% countries_list$strong_countries_pairs & !countries_list$oecd_countries_pairs %in% countries_list$weak_countries_pairs]

reg_list = list()

hyp_test_list = list()


control_vars = c("trade_gdp","FX_stab_tot","FO_ind_tot","MI_ind_tot",
                 "GDP_real_tot")


reg_formula = paste("Fin_synch ~ lag(bank_gdp,1) * Crises",
                    "lag(bank_gdp,1) * FD_tot",
                    # "lag(bank_gdp,1) * EU_both",
                    # "lag(bank_gdp,1) * Euro_both",
                    "lag(bank_gdp,1) * Common_Lang",
                         paste(control_vars,
                               collapse = "+"),
                        "CountryPair:Time_Trend",
                     sep = "+")



temp_names = c("lag\\(bank_gdp, 1\\)",
               "Crises",
               "FD_tot",
               # "EU_both",
               # "Euro_both",
               "lag\\(bank_gdp, 1\\):Crises",
               "lag\\(bank_gdp, 1\\):FD_tot",
               # "lag\\(bank_gdp, 1\\):EU_both",
               # "lag\\(bank_gdp, 1\\):Euro_both",
               "lag\\(bank_gdp, 1\\):Common_Lang")

temp_names_lag = c("lag\\(bank_gdp, 1\\)",
               "lag\\(Crises, 1\\)",
               "lag\\(FD_tot, 1\\)",
               # "lag\\(EU_both, 1\\)",
               # "lag\\(Euro_both, 1\\)",
               "lag\\(bank_gdp, 1\\):lag\\(Crises, 1\\)",
               "lag\\(bank_gdp, 1\\):lag\\(FD_tot, 1\\)",
               # "lag\\(bank_gdp, 1\\):lag\\(EU_both, 1\\)",
               # "lag\\(bank_gdp, 1\\):lag\\(Euro_both, 1\\)",
               "lag\\(bank_gdp, 1\\):lag\\(Common_Lang, 1\\)")


temp_labels = c("Bank linkages (lag)",
                "Crises",
                "FD",
                # "EU both",
                # "Euro both",
                "Bank linkages (lag) * Crises",
                "Bank linkages (lag) * FD",
                # "Bank linkages (lag) * EU both",
                # "Bank linkages (lag) * Euro both",
                "Bank linkages (lag) * Commong Lang")



```


```{r Import_raw_data}

raw_data = list()

raw_data$HousePrice = import.bis.property.price.data(
  countries_vec = countries_list$oecd_countries) %>% 
  mutate(Date = as.yearqtr(Date, format = "%Y-Q%q"))

raw_data$TotalCredit = import.bis.tot.credit.data(
  countries_vec = countries_list$oecd_countries) %>% 
  mutate(Date = as.yearqtr(Date, format = "%Y-Q%q"))

raw_data$WDI_annual = import_wdi_df(
  countries_vec = countries_list$oecd_countries) %>% 
  mutate(GDP = GDP * 10 ^ (-6)) # Convert to millions USD


raw_data$bis_lbs = import.bis.lbs.data(
  countries_vec = countries_list$oecd_countries) %>% 
  mutate(Date = as.yearqtr(Date, format = "%Y-Q%q"))

# raw_data$Harmon_both_quarter = import.harmon.data() %>% 
#   construct_countrypair_harmon_index(.,dates_vec = seq.Date(
#     from = as.Date(min(raw_data$bis_lbs$Date)),
#     to = as.Date(max(raw_data$bis_lbs$Date)),
#     by = "quarter") %>% as.yearqtr())
# 
# raw_data$Harmon_one_quarter = import.harmon.data() %>% 
#   construct_countrypair_harmon_index(.,dates_vec = seq.Date(
#     from = as.Date(min(raw_data$bis_lbs$Date)),
#     to = as.Date(max(raw_data$bis_lbs$Date)),
#     by = "quarter") %>% as.yearqtr(),index_status = "one")

raw_data$codes = read.csv(paste0("C:\\Users\\Misha\\Documents",
                                 "\\Data\\ISO\\",
                                 "iso_2digit_alpha_country",
                                 "_codes.csv")) %>% 
  setNames(c("Code","Country"))



  

```


```{r Import_raw_data_EU_membership}

eu_df = read.csv(paste0("C:\\Users\\Misha\\Documents\\",
                        "Data\\Misc\\EU_membership.csv"),
                 stringsAsFactors = FALSE) %>% 
  setNames(c("Country","Euro_area","EU")) %>% 
  mutate(Country = gsub("\\s","_",Country)) %>% 
  mutate(Country = sub("The_Netherlands","Netherlands",
                       Country,fixed = TRUE)) %>% 
  mutate(Country = sub("Slovakia","Slovak_Republic", Country,fixed = TRUE))


eu_dates_vec = seq.Date(
    from = as.Date(min(raw_data$bis_lbs$Date)),
    to = as.Date(max(raw_data$bis_lbs$Date)),
    by = "year") %>% 
  format(.,"%Y")

raw_data$EU_both = construct_countrypair_EU_index(
  eu_df = eu_df %>% 
    select(Country, EU) %>% 
    rename(Date = EU),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries) %>% 
  rename(EU_both = Status) %>% 
  mutate(Date = as.character(Date))

raw_data$EU_one = construct_countrypair_EU_index(
  eu_df = eu_df %>% 
    select(Country, EU) %>% 
    rename(Date = EU),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries,
  index_status = "one") %>% 
  rename(EU_one = Status) %>% 
  mutate(Date = as.character(Date))


raw_data$Euro_both = construct_countrypair_EU_index(
  eu_df = eu_df %>% 
    select(Country, Euro_area) %>% 
    rename(Date = Euro_area) %>% 
    filter(!Date == "Not a member"),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries) %>% 
  rename(Euro_both = Status) %>% 
  mutate(Date = as.character(Date))

raw_data$Euro_one = construct_countrypair_EU_index(
  eu_df = eu_df %>% 
    select(Country, Euro_area) %>% 
    rename(Date = Euro_area),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries,
  index_status = "one") %>% 
  rename(Euro_one = Status) %>% 
  mutate(Date = as.character(Date))

rm(eu_df, eu_dates_vec)

```


```{r Import_raw_data_common_language}

raw_data$geodist = import.geodist.data() %>% 
  filter(Country %in% countries_list$oecd_countries) %>% 
  filter(Counter_Country %in% countries_list$oecd_countries) %>% 
  mutate(CountryPair = ifelse(Country < Counter_Country,
                              paste(Country, Counter_Country, sep = "-"),
                              paste(Counter_Country,Country, sep = "-"))) %>% 
  select(-Country, -Counter_Country) %>% 
  distinct()

```


```{r Import_raw_data_crises_dates}

raw_data$crises_df =  import.crises.dates.df(countries_vec = countries_list$oecd_countries)

```


```{r make_country_df}

df_list = list(raw_data$TotalCredit %>%
  filter(quarters(Date) == "Q4") %>%
  mutate(Date = format(Date, "%Y")) %>% 
  deflate.data(.,vars_to_deflate = "Total_Credit") %>% 
  select(-Total_Credit),
  raw_data$HousePrice %>%
  filter(quarters(Date) == "Q4") %>%
  mutate(Date = format(Date, "%Y")),
  raw_data$WDI_annual %>%
  rename(Date = Year) %>%
  select(-GDP_per_Capita) %>% 
  deflate.data(.,vars_to_deflate = c("GDP"),
               cpi = raw_data$CPI) %>% 
  select(-GDP))


country_df = df_list %>% 
  reduce(right_join, by = c("Date", "Country")) %>% 
  group_by(Country) %>% 
  arrange(Date) %>% 
  mutate_at(.vars = c("Total_Credit_real","HousePrice"),
            .funs = list(ret = ~ . / dplyr::lag(., order_by = Date) - 1)) %>%
  # mutate_at(.vars = c("Total_Credit_real","HousePrice"),
  #           .funs = list(ret = ~c(NA,diff(log(.))))) %>%
  mutate_at(.vars = vars("Total_Credit_real","HousePrice"),
            .funs = list(cycle = ~cffilter(., pl = 2 * 4,
                                           pu = 8* 4 )[["cycle"]] / .)) %>%
  mutate(Fin_ret = rowMeans(data.frame(Total_Credit_real_ret,
                                      HousePrice_ret),na.rm = TRUE)) %>%
  mutate(Fin_cycle = rowMeans(data.frame(Total_Credit_real_cycle,
                                      HousePrice_cycle),na.rm = TRUE)) %>%
  ungroup() %>%
  filter(is.finite(Fin_ret)) %>% 
  filter(Date >=1978)

rm(df_list)



```


```{r Import_trilemma_data}

country_df = left_join(country_df, import.trilemma.ind(),
               by = c("Country","Date"))

```


```{r Import_fin_development_data}

country_df = left_join(country_df, import.fin.dev.ind(),
               by = c("Country","Date"))



```


```{r make_bank_list}

bank_list = list()

raw_data$bank_balance_real_norm = raw_data$bis_lbs %>%
  filter(quarters(Date) == "Q4") %>%
  mutate(Date = format(Date, "%Y")) %>%
  deflate.data(.,vars_to_deflate = "Balance") %>%
  select(Date, CountryPair,Balance_Pos, Balance_real) %>%
  normalize.bis.data(.,norm_df = country_df[,c("Date","Country", "GDP_real")],
                     norm_val = "GDP_real")

bank_list$bank_gdp = raw_data$bank_balance_real_norm   %>% 
  group_by(Date, CountryPair) %>%
  summarise(bank_gdp = mean(log(Balance_real), na.rm = TRUE)) %>%
  filter(!is.na(bank_gdp))
  
# bank_pop = bank_balance_real  %>%
#   normalize.bis.data(.,norm_df = df[,c("Date","Country", "Pop")],
#                      norm_val = "Pop") %>% 
#   group_by(Date, CountryPair) %>%
#   summarise(bank_pop = mean(log(Balance_real), na.rm = TRUE)) %>%
#   filter(!is.na(bank_pop))


```


```{r Import_IMF_Data}

trade_list = list()

export_df = lapply(list.files(paste0("C:\\Users\\Misha\\Documents\\Data",
                                     "\\IMF\\Export-Import\\Export"),
                              full.names = TRUE),
                   import_imf_df,
                   countries_vec = countries_list$oecd_countries) %>% 
  bind_rows() %>% 
  mutate(Exports = as.numeric(Exports)) %>% 
  group_by(Date, CountryPair) %>% 
  summarise(Exports = sum(Exports, na.rm = TRUE))


import_df = lapply(list.files(paste0("C:\\Users\\Misha\\Documents\\Data",
                                     "\\IMF\\Export-Import\\Import"),
                              full.names = TRUE),
                   import_imf_df,
                   countries_vec = countries_list$oecd_countries) %>% 
  bind_rows() %>% 
  mutate(Imports = as.numeric(Imports)) %>%
  group_by(Date, CountryPair) %>% 
  summarise(Imports = sum(Imports, na.rm = TRUE))

trade_df = full_join(export_df,import_df, by = c("Date", "CountryPair")) %>% 
  gather(.,key = Balance_Pos, value = Trade, -Date, - CountryPair) %>% 
  deflate.data(.,vars_to_deflate = "Trade") %>% 
  select(-Trade)


trade_list$trade_gdp = trade_df %>%
  ungroup() %>% 
  normalize.imf.data(.,wdi_df = country_df[,c("Date","Country", "GDP_real")],
                     norm_val = "GDP_real") %>%
  group_by(Date, CountryPair) %>%
  summarise(trade_gdp = mean(log(Trade_real), na.rm = TRUE)) %>%
  filter(!is.na(trade_gdp)) %>% 
  filter(is.finite(trade_gdp))

rm(export_df, import_df, trade_df)



```


```{r make_indicators_list}

ind_list = list()
  
# ind_list$Harmon_both = raw_data$Harmon_both_quarter %>% 
#                        mutate(Date = format(Date, "%Y")) %>% 
#                        group_by(CountryPair, Date, Directive) %>% 
#                        summarise(Transposed = max(Transposed)) %>% 
#                        group_by(Date,CountryPair) %>% 
#                        summarise(Harmon_both_Index = log(
#                          sum(Transposed + 1,na.rm = TRUE)))
# 
#  ind_list$Harmon_one = raw_data$Harmon_one_quarter %>% 
#                        mutate(Date = format(Date, "%Y")) %>% 
#                        group_by(CountryPair, Date, Directive) %>% 
#                        summarise(Transposed = max(Transposed)) %>% 
#                        group_by(Date,CountryPair) %>% 
#                        summarise(Harmon_one_Index = log(
#                          sum(Transposed + 1,na.rm = TRUE)))
   
   ind_list$EU_both = raw_data$EU_both

   ind_list$EU_one =  raw_data$EU_one

   ind_list$Euro_both =  raw_data$Euro_both

   ind_list$Euro_one = raw_data$Euro_one


```


```{r make_countrypair_df}


country_pair_df = unlist(list(bank_list, trade_list, ind_list),
                         recursive = FALSE) %>% 
  reduce(left_join, by = c("Date","CountryPair"))



```


```{r country_pair_df_add_crises_indicator}

country_pair_df = country_pair_df %>% 
  separate(col = CountryPair,into = c("Country_A","Country_B"),
           sep = "-", remove = FALSE) %>% 
  group_by(Country_A) %>% 
  mutate(Country_A_crises = classify_crises_dates(
    Target_Country = Country_A[1],
    dates_vec = Date,
    crises_df = raw_data$crises_df[,1:3])) %>% 
  group_by(Country_B) %>% 
  mutate(Country_B_crises = classify_crises_dates(
    Target_Country = Country_B[1],
    dates_vec = Date,
    crises_df = raw_data$crises_df[,1:3])) %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(Crises_tot = sum(Country_A_crises, Country_B_crises)) %>% 
  mutate(Crises_one = as.numeric(Crises_tot ==1)) %>% 
  mutate(Crises_both = as.numeric(Crises_tot ==2)) %>% 
  mutate(Crises = min(Crises_tot,1)) %>% 
  ungroup() %>% 
  select(-Country_A,-Country_B)

```


```{r country_pair_df_add_geodist}

country_pair_df = country_pair_df %>% 
  left_join(.,raw_data$geodist %>% 
              select(CountryPair, comlang_ethno) %>% 
              rename(Common_Lang = comlang_ethno) %>% 
              distinct(), by = "CountryPair")
```


```{r country_pair_df_add_controls}

controls =  c("FX_stab","MI_ind","FO_ind","FD","GDP_real","Pop")

country_pair_df = append.countrypair.dataframe(
  country_pair_df,
  country_df %>%
    select(Date,Country,controls) %>% 
    mutate(GDP_real = log(GDP_real))) %>% 
  collapse_pair_controls(controls,collapse_funcs = "sum")
 
rm(controls)


```


<!-- Dataset construction -->

```{r make_fin_reg_df_old, eval=FALSE}

fin_reg_df = construct_fin_reg(
  df = df %>% 
    select(c("FX_stab","MI_ind","FO_ind","FD","GDP_real","Pop",
             "Country","Date","Fin_ret")) %>% 
    mutate(GDP_real = log(GDP_real),
           Pop = log(Pop)),
  countries_vec = countries_list$oecd_countries,
  control_vars = c("FX_stab","MI_ind","FO_ind","FD","GDP_real","Pop"),
  collapse_funcs = c("sum"))

fin_reg_df = fin_reg_df %>% 
  full_join(.,get.roll.cor(df %>% select(Date, Country,Fin_cycle),win_len = 5) %>% 
              rename(Fin_cycle_corr = Fin_cycle),
            by = c("Date","CountryPair"))

fin_reg_df = fin_reg_df %>% 
  full_join(.,country_pair_df, by = c("Date","CountryPair"))

fin_reg_df = fin_reg_df %>% 
  filter(!is.na(CountryPair)) %>% 
  filter(!is.na(Fin_synch)) %>% 
  filter(!is.na(bank_gdp)) %>% 
  filter(!is.na(Date))


temp_lm_resid = function(x,Time){
  
  if(sum(!is.na(x)) < 2){return(rep(NA, length(x)))}
  
  return(residuals(lm(x ~ Time)))
  
}


fin_reg_df = fin_reg_df %>% 
  group_by(CountryPair) %>% 
  mutate(Time_trend = seq.int(from = 1,to = length(Date))) %>% 
  # mutate(bank_gdp_delta = c(NA, diff(bank_gdp))) %>% 
  # mutate(Fin_synch_delta = c(NA, diff(Fin_synch))) %>% 
  # mutate(bank_gdp_detrended = temp_lm_resid(bank_gdp, Time_trend)) %>% 
  # mutate(Fin_synch_detrended = temp_lm_resid(Fin_synch, Time_trend)) %>% 
  # mutate(Harmon_both_detrended = temp_lm_resid(Harmon_both_Index,
  #                                              Time_trend)) %>% 
  ungroup()

fin_reg_df$CountryPair_Category[fin_reg_df$CountryPair %in% countries_list$strong_countries_pairs] = "KPP"

fin_reg_df$CountryPair_Category[fin_reg_df$CountryPair %in% c(countries_list$weak_countries_pairs, countries_list$cross_country_pairs)] = "Complement"


# saveRDS(fin_reg_df, "C:\\Users\\Misha\\Desktop\\temp_df.rds")


```


```{r make_dep_df}

fin_synch = get.neg.abs.diff(country_df[,c("Date","Country","Fin_ret")]) %>% 
  rename(Fin_synch = Fin_ret)

credit_synch = get.neg.abs.diff(country_df[,c("Date","Country",
                                              "Total_Credit_real_ret")]) %>% 
  rename(Credit_synch = Total_Credit_real_ret)

house_synch = get.neg.abs.diff(country_df[,c("Date","Country",
                                             "HousePrice_ret")]) %>% 
  rename(House_synch = HousePrice_ret)



```


```{r make_fin_df}

fin_reg_df = list(country_pair_df, fin_synch, credit_synch, house_synch) %>%
  reduce(left_join, by = c("CountryPair","Date")) %>% 
  group_by(CountryPair) %>% 
  mutate(Time_Trend = seq_along(Date)) %>% 
  ungroup() %>% 
  mutate(Fin_synch = 100 * Fin_synch) %>% 
  mutate(Credit_synch = 100 * Credit_synch) %>% 
  mutate(House_synch = 100 * House_synch)

# fin_reg_df$CountryPair_Category[fin_reg_df$CountryPair %in% countries_list$strong_countries_pairs] = "KPP"
# 
# fin_reg_df$CountryPair_Category[fin_reg_df$CountryPair %in% c(countries_list$weak_countries_pairs, countries_list$cross_country_pairs)] = "Complement"

```


```{r filter_outliers}

country_pairs_table = table(fin_reg_df$CountryPair)

fin_reg_df = fin_reg_df %>%
  filter(CountryPair %in% names(country_pairs_table)[
    country_pairs_table > 10])

# fin_reg_df = fin_reg_df %>% 
#   filter(bank_gdp >= quantile(bank_gdp,0.025) &
#          bank_gdp <= quantile(bank_gdp,0.975))

```


```{r save_temp_data, eval=save_temp_status}

write_rds(x = raw_data,
        path = paste0("C:\\Users\\Misha\\Documents\\Data\\TempData",
                      "\\temp_raw_data.rds"))

write_rds(x = country_df,
        path = "C:\\Users\\Misha\\Documents\\Data\\TempData\\temp_country_df.rds")


write_rds(x = fin_reg_df,
        path = "C:\\Users\\Misha\\Documents\\Data\\TempData\\temp_fin_df_new.rds")

```


<!-- Regression analysis -->


```{r estimation}


reg_list$baseline = plm(formula = formula(reg_formula),data = fin_reg_df,
          model = "within",effect = "twoways",
          index = c("CountryPair","Date"))


coef_vec = coefficients(reg_list$baseline)

coef_vec = coef_vec[names(coef_vec) %in% c("lag(bank_gdp, 1)",
                                           "lag(bank_gdp, 1):Crises",
                                           "lag(bank_gdp, 1):FD_tot")]

```


```{r robustness}

reg_list$credit = plm(formula = formula(sub("Fin_synch","Credit_synch",
                                           reg_formula, fixed = TRUE)),
                      data = fin_reg_df,
                      model = "within",effect = "twoways",
                      index = c("CountryPair","Date"))


reg_list$house = plm(formula = formula(sub("Fin_synch","House_synch",
                                           reg_formula, fixed = TRUE)),
                     data = fin_reg_df,
                     model = "within",effect = "twoways",
                     index = c("CountryPair","Date"))



reg_list$lag = plm(
  formula = formula(paste("Fin_synch ~ lag(bank_gdp,1) * lag(Crises,1)",
                                  "lag(bank_gdp,1) * lag(FD_tot,1)",
                                  "lag(bank_gdp,1) * lag(EU_both,1)",
                                  # "lag(bank_gdp,1) * lag(Euro_both,1)",
                                  "lag(bank_gdp,1) * lag(Common_Lang,1)",
                                  paste(paste0("lag(",control_vars,",1)"),
                                        collapse = "+"),
                                  "CountryPair:Time_Trend",
                                  sep = "+")),data = fin_reg_df,
          model = "within",effect = "twoways",
          index = c("CountryPair","Date"))


```



<!-- Regression analysis 1978-2006 period-->


```{r estimation_crisis_fd_2007}

reg_list$before_2007 = plm(formula = formula(reg_formula),
          data = fin_reg_df %>% filter(Date <= 2006),
          model = "within",effect = "twoways",
          index = c("CountryPair","Date"))

coef_vec_before_2007 = coefficients(reg_list$before_2007)

coef_vec_before_2007 = coef_vec_before_2007[names(coef_vec_before_2007) %in%
                                              c("lag(bank_gdp, 1)",
                                                "lag(bank_gdp, 1):Crises",
                                                "lag(bank_gdp, 1):FD_tot")]


```


<!-- Regression analysis no trend-->


```{r estimation_no_trend}

reg_no_trend_formula = paste("Fin_synch ~ lag(bank_gdp,1) * Crises",
                             "lag(bank_gdp,1) * FD_tot",
                             # "lag(bank_gdp,1) * EU_both",
                             "lag(bank_gdp,1) * Euro_both",
                             "lag(bank_gdp,1) * Common_Lang",
                             paste(control_vars, collapse = "+"),
                             sep = "+")


reg_list$no_trend = plm(formula = formula(reg_no_trend_formula),
                   data = fin_reg_df,
                   model = "within",effect = "twoways",
                   index = c("CountryPair","Date"))


```


<!-- Instrumental variable regression -->

```{r save_temp_reg, eval=FALSE}

write_rds(x = reg_list,
        path = "C:\\Users\\Misha\\Documents\\Data\\TempData\\temp_reg.rds")

```



\section{Introduction} 

<!-- What do you do -->

This work studies the relationship between financial cycles synchronization and financial integration. A recent line of research studies the relationship between business synchronization and financial integration. For example, @Kalemli-Ozcan2013JF find that output synchronization is negatively affected by financial integration. The authors explain the connection as follows: if a country is hit with a negative productivity shock, global banks will reduce credit to that country and increase credit to another country, thus, exacerbating negative output effect in the former country and facilitating positive output effect in the latter. In this paper, I test whether the same mechanism applies to financial synchronization.

<!-- Why is it important -->
The theory provides ambiguous predictions regarding the effect of financial integration on financial cycles synchronization. On the one hand, financial integration can help diversify risk, redirect capital to more profitable investment opportunities and act as country-specific "shock absorber". In that case, the association between banking integration and financial synchronization should be negative. On the other hand, banking integration can induce contagion effects and act as global "shock propagator". In that case, a positive association should be observed. This paper attempts to shed some light on the association between banking integration and financial cycles synchronization.

<!-- How do you do it (methodology) -->

To this end, I follow the methodology suggested by @Kalemli-Ozcan2013JF. Specifically, I use their measures of cycles synchronization and banking linkages and run a panel regression controlling for common and time-invariant unobservable factors. I also control for (as much as possible) other economic factors that can affect both financial cycle synchronization and banking integration. While the authors focus on 18 OECD countries I expand my sample to all OECD countries.

<!-- What do you find -->
I find evidence that financial integration is negatively associated with cycles synchronization thus acting as a shock absorbent. My results show that the relationship is state dependent: I find that during financial crises financial integration is associated with more synchronized financial cycles relative to normal times. In a highly developed financial market, integration is also associated with more synchronized cycles relative to a low level of financial development. 

<!-- Contribution and policy implications -->

This paper contributes to the literature in several ways: first, I contribute to the literature on financial cycles by identifying the situations in which financial cycles become more synchronized. Second, I contribute to the strand of literature that studies financial integration. The literature stresses that financial integration can function as "shock absorbent" or "shock propagator", I identify the conditions that characterize each of the effects.


<!-- paper outline -->

The paper is structured as follows. In section \ref{LitReview} I review the relevant literature and theoretical considerations. Empirical specification are formulated in section \ref{EmpSpec}. Section \ref{Data} provides a description of the data. Estimation results are presented in section \ref{results} and robustness test in section \ref{Robust}. Section \ref{conclusions} consludes the paper.




\section{Literature review} \label{LitReview}

This paper is related to both the financial cycles and financial integration strands of the literature. 

The literature on financial cycles defines the components of the financial cycle and attempts to study the interactions between business and financial cycles.
@Borio2014 stresses the role of the financial cycle in macroeconomics and suggest that the most parsimonious description of the financial cycle can be made in terms of credit and property prices. @Claessens2012 analyze the interaction between business and financial cycles. They show that recessions in the business cycle that are related to financial cycle contraction tend to be deeper and longer relative to other recessions. @Meller2017 study the synchronization of credit cycles. They look at 14 advanced countries in 1906-2008 years using cluster analysis and find that there are several clusters with different synchronization patterns. They also find positive synchronization of business and credit cycle. Unfortunately, cluster analysis is unable to provide insight into the factors that affect the synchronization of credit cycles and I attempt to make some progress in this direction.

Financial integration is a phenomenon in which financial markets in neighboring, regional or global economies are closely linked together. The literature in this field (see @Kose2009 for survey and summary) discuss the benefits and dangers of financial integration.  Potential benefits of financial integration include efficient capital allocation, better governance, higher investment and growth, and risk-sharing. At the same time, financial integration can also have adverse effects. A higher degree of financial integration can generate severe financial contagion in integrated economies. @Popov2012 study banking integration and identify a mechanism by which financial shocks propagate through cross border linkages. The authors show that a negative shock to parent (foreign) bank leads to a reduction in lending provided by its subsidiaries abroad. @Degryse2010 analyze the extent of contagion risk through banking linkages. They focus on the 1999-2006 period and ran a simulation based on cross border bank linkages and banks equity. The authors conclude that contagion risk had increased during that period. They also find that contagion is more widespread in geographical proximities. @Avdjiev2019 study the factors that affect lending behavior of global banks’ subsidiaries throughout the world. The authors divide the influencing factors to two groups: "push" (global drivers) factors and "pull" factors such as macroeconomic conditions that measure the local cost of funding and the strength of the borrowers' balance sheets and the financial conditions of the global bank's subsidiaries. They find that the lending behavior of the subsidiaries is more closely related to local macroeconomic conditions and their financial conditions than to those of their owner-specific counterparts, namely that the "pull" factors are more important relative to "push" factors. From a financial stability point of view, the "push" factors increase synchronization (the contagion or propagation effect) while the "pull" factors should reduce synchronization (absorption effect) due to idiosyncratic shocks. @Cerutti2015 analyze the composition and drivers of cross-border bank lending between 1995 and 2012, distinguishing between syndicated and non-syndicated loans. They find (among other results) that banking integration (cross border credit) is closely related to the level of development and sophistication of the banking system, strength of balance sheets and regulation.
 
@Kalemli-Ozcan2013JF find that output cycle synchronization is negatively affected by financial integration. They suggest that banking integration magnifies productivity
shocks (to regions or to countries), making output growth among integrated economies
diverge. I use their methodology to analyze financial cycles synchronization.


\section{Empirical specification} \label{EmpSpec}

The baseline specification  (following along the lines of @Kalemli-Ozcan2013JF) is

$FinSynch_{i,j,i} = \alpha_{i,j} + \delta_{t} + \beta BankLinkages_{i,j,t-1} + Controls_{i,j,t} + \varepsilon_{i,j,t}$

where $FinSynch$ is a measure of synchronization of financial cycles and $BankLinkages$ is a measure of banking integration between two countries.

This specification includes time and country-pair fixed effect in order to control for unobservable time and country-pair specific factors (such as cultural difference or turmoil years). The year fixed effects account for the effect of global shocks and other common time-varying factors that affect both financial cycle patterns and banking integration. The country-pair effects account for hard-to-measure factors such as cultural ties and similarities, informational frictions, and other time-invariant unobservable factors that have an effect on both financial integration and financial cycle patterns. To account for the trend and the nonstationary nature of banking integration (see Figures \ref{plot_bank_gdp} and \ref{plot_bank_gdp_strata}), I add country-pair specific linear time trend. I choose a linear trend for reasons of simplicity and comparability with @Kalemli-Ozcan2013JF, see @Bouvatier2015 for use of trends in banking integration measures. It should be noted that my results are sensitive to the inclusion of the trend\footnote{Exclusion of the trend turns some of the coefficients to insignificant, the main result holds. I present estimation without trend in section \ref{Robust}.} and it may be the case that the trend picks up the effect of some other omitted variable. Since I'm only interested in estimating the bank linkages effect in the regression (as opposed to explicitly modeling all the factors that affect financial synchronization), controlling for other variables (trend or another omitted variable) seems required.


The estimation results can be subject to endogeneity problem for reasons of omitting relevant variable or reverse causality. In order to address this issue, I take several steps: first, I augment the specified regression with a set of variables in order to control for other economic factors that can affect both financial cycle synchronization and banking integration. @Chinn2010 suggest that the most important factors for monetary policy are foreign exchange stability, monetary independence, and financial openness. The authors construct indexes of the relevant measures and I include them in the control variables set. I also include trading linkages and gravity measure\footnote{All the variables are explained in Appendix.} in the controlling variables set. Second, bank linkages enter in my specification in a lagged form (again following @Kalemli-Ozcan2013JF), that should attenuate the reverse causality problem.

@Kalemli-Ozcan2013JF focused on 18 members of OECD for 1978-2006 years.
I expand the sample to include all the OECD countries for `r paste(range(fin_reg_df$Date), collapse = "-")` period.


\subsection{Crisis effect}
Several papers (see @Kalemli-Ozcan2013, @Aysun2019, @Fratzscher2012) find that during financial crises times the effect of global ("push") factors in cross border bank lending increases. If during financial crises times common (global) shocks are prevalent that should induce more synchronized financial cycles. That means that the crisis effect should be positive and the "shock propagator" role of banking integration should increase during crisis times.

In order to account for those findings, I introduce an indicator variable for banking crises periods. The variable equals 1 if at least one country of the country-pair is going through banking crises at period \textit{t}. The data comes from an updated version of @Laeven2013 and includes the start and end year of banking crises in the OECD countries for the entire sample period. I expect that the effect of banking integration will be different in crises vs normal times and in order to capture this difference I add an interaction variable between bank linkages and crisis indicator to the estimation equation.



\subsection{Financial development}

@Mendoza2009 study the relationship between financial development and global imbalances. The authors show that financial development varies widely even among industrial countries and that financial integration can have different effects when countries differ in financial markets development. Countries with deeper financial markets react to financial integration by borrowing from abroad and investing in high-return foreign risky assets while countries that are less financially developed accumulate positions in safer assets.

@Bahadir2015 show that financial development convergence takes places. Countries with a high level of financial development exhibit lower credit growth rates in comparison to countries with a low level of financial development. @Kil2017 confirm the financial development convergence for EU15 countries. They find that both credit and stock markets exhibit convergence meaning that growth rates of these markets decrease at high levels of development. 

@Fisman2004 analyze the role of financial development in allocating resources. They argue that global (productivity) shocks will induce comovement of growth rates among countries with a high level of financial development since undeveloped countries will not be able to react to the shocks of other countries. Thus, financial development at a high level can transmit global shocks and induce comovement in economic activity.

I hypothesize that this phenomenon (financial development at high level inducing comovement) holds with respect to financial activity as well. An example is given in @Acharya2010. The authors analyze an investment strategy of large commercial banks that set up asset back commercial paper (ABCP) conduits. This strategy involved selling to investors short-term asset-backed commercial paper and investing the proceeds mainly in US asset back longer-term securities. Once negative news about US assets emerged, all the banks suffered significant losses, thus inducing comovement. This investment strategy required a highly developed domestic financial market (financing through commercial paper instruments), and it is not surprising that the list of countries whose banks were pursuing this strategy includes US, UK, Germany, France, Belgium, and Portugal - highly developed countries.

To account for the fact that the effect of financial integration depends on the level of domestic financial development I include an index of financial development (the sum of financial development index of each country in the country-pair) and an interaction term between financial development and banking integration. Data on financial development index comes from @Sviry2016 and includes an index of financial development of all the countries in my sample for `r paste(range(fin_reg_df$Date[!is.na(fin_reg_df$FD_tot)]), collapse = "-")` period.


\subsection{Cultural Similarities}

@Grinblatt2001 documents the importance of cultural similarites like distance, language and culture for financial decisions. The authors show that investors prefer to invest in firms that issue reports in their mother tongue and have chief executives of the same cultural background. @Altug2013 show that business cycle features are related to institutional and cultural characteristics, and that cultural features matter for cycles synchronization.
@Frankel1998 analyze business cycles synchronization and find that countires that share common language tend to exhibit greater synchronization. The financial counterpart of this finding is the hypothesis that common language is associated with higher financial synchronization. In order to account for cultural differences I add an interaction term between common language indicator and banking integration\footnote{Country-pair fixed effects absorb the unconditional effect of common language}.

<!-- \subsection{Common currency area} -->

<!-- @Rose2005 survey the literature on currency unions, they show that currency union increases bilateral trade by between 30 and 90%. Since trade linkages and financial linkages are positively corellated I expect currency union to have similiar effect on financial linkages. @Gonzales2009 find that bussiness cycles synchronization increases after the adoption of Euro currency, thus, I hypothesize that financial synchronization should be higher in Euro countries and that banking linkages should induce higher synchronization in those countries -->


\section{Data} \label{Data}


\subsection{Bank linkages}

I use data on bilateral cross-border bank positions gathered from the Bank for International Settlements’ (BIS) databank on the residence-based locational banking statistics (LBS). The LBS detail at the country level the geographical composition of banks’ balance sheets and capture outstanding claims and liabilities of banking offices located in the BIS reporting countries, including intragroup positions, and exclude local claims of foreign branches and subsidiaries. 

The BIS statistics have possibly the most extensive time coverage from all similar database on cross-border investment holdings (as a comparison to the IMF CPIS database that reports bilateral cross-border financial flows and stocks after 1999). The main limitation of the dataset is that it reports the aggregate international exposure only of the banking system. Yet, cross-border banking activities have been the largest component of cross-border investment in the 1980s and the 1990s, and even nowadays it consists of the bulk of international finance. As long as there is a high correlation between international banking and other forms of portfolio investment (equity flows, FDI, and debt flows), my estimates will not be systematically biased. The BIS data are expressed originally in current U.S. dollars (millions). Following @Kalemli-Ozcan2013JF I convert the data into constant U.S. dollars by deflating the series with the U.S. consumer price index (CPI). Then I use the total stock of external assets and liabilities to construct a quantity-based measure of financial integration\footnote {Stocks seem to be better measurements than flows for financial integration, see @Prasad2003}. My main measure is the average of (the logs of) real bilateral asset and liability holdings as a share of the two countries’ GDP. 

\begin{align*}
	Banklinkages_{i,j,t} =& \frac{1}{4} \bigg[
	log\left(\frac{Assets_{i,j,t}}{GDP_{i,t} + 
	GDP_{j,t}}\right)  + log\left(\frac{Liabilities_{i,j,t}}{GDP_{i,t} + 
	GDP_{j,t}}\right)  + \\ & log\left(\frac{Assets_{j,i,t}}{GDP_{i,t} +
	GDP_{j,t}}\right)  + log\left(\frac{Liabilities_{j,i,t}}{GDP_{i,t} +
	GDP_{j}}\right) \bigg]
\end{align*}



\subsection{Financial cycles synchronization}

Credit and property prices considered as the most fundamental components of the financial cycle and are extensively used in the literature (see @Drehmann2012, @Grinderslev2017). @Borio2014 argues that the most parsimonious description of the financial cycle can be made in terms of credit and property prices. Following this literature, I use total credit and property prices data to estimate the financial cycle. Importantly, total credit account for credit from all sources, namely credit from financial accounts, domestic bank credit, and cross-border bank credit are the three main building blocks underlying the construction of the total credit series. Property prices come from BIS selected residential property prices data set. The selected residential property prices are harmonized as much as possible with recommendations in the Handbook on residential property prices, an internationally agreed framework for classifying property price issues.


I calculate the annual log difference of each variable and then take a simple average to obtain the growth of the financial cycle. As a measure of synchronization of financial cycles, I use the negative of divergence in growth rates defined as the absolute value of financial cycle growth differences between country \textit{i} and country \textit{j} in period \textit{t}.

\begin{equation*}
FinSynch_{i,j,i} = -\lvert FinRet_{i,t}  - FinRet{j,t} \rvert
\end{equation*}

where:

\begin{equation*}
FinRet_{i,t} = 0.5 \cdot ln \left(  \frac{TotalCredit_{t}}{TotalCredit_{t-1}} \right) 
+0.5 \cdot ln\left( \frac{HousePrice_{t}}{HousePrice_{t-1}} \right) 
\end{equation*}	

This index is simple and quite popular (for example @Kalemli-Ozcan2013, @Giannone2010). In contrast to the correlation measures, it is not sensitive to the various filtering methods that have been criticized on many grounds (e.g.,@Canova1998).
It also does not contain estimation error that emerges, for example, from self-selecting a rolling estimating window. 


\subsection{Descriptive Statistics} \label{DescStat}

Summary statistics of the data are presented in table \ref{summary_table}.

```{r countrypair_table_summary, include=FALSE}


star = stargazer(fin_reg_df %>% 
                   select(Fin_synch, bank_gdp, FD_tot) %>% 
                   as.data.frame(),
                 table.placement = "H",
                 label = "summary_table",
          header =FALSE, summary = TRUE,
          digits = 2,digits.extra = 2,
          summary.stat = c("max","min","mean","median","sd","n"),
          notes = paste0("\\parbox[t]{16cm}{",
                         paste0("Note: The table reports summary statistics of ",
                                "the main variables used in the empirical ",
                                "analysis. Financial cycles synchronization is the ",
                                " negative of the absolute difference in ",
                                "financial cycle growth between country \\textit{i}",
                                " and country \\textit{j} in year \\textit{t}. ",
                                "Bank linkages is the cross border banking ",
                                "claims. ",
                                "Financial development is the sum of the ",
                                "level of each country financial development ",
                                "index. ","Crises is an indicator variable ",
                                "that equals 1 if at least one country ",
                                "undergoes ",
                                "banking crises at that year. "),
                         "}"))


star = sub("Fin\\_synch","Fin cycles synch",star,fixed = TRUE)

star = sub("bank\\_gdp","Banking linkages",star,fixed = TRUE)

star = sub("FD\\_tot","Financial development",star,fixed = TRUE)

# star = sub("−0.0000","0.00",star,fixed = TRUE)


rm(temp_df, df_list)

```


```{r output_summary_table, results="asis"}

cat(star, sep = "\n")

```


Figure \ref{plot_bank_gdp} shows the average cross border (bilateral) bank linkages of the countries in my sample. We can see that financial integration had increased since the 1980s until 2007-2008 (the Global Financial Crises)  and then a sharp drop followed, dropping below initial levels. The shaded area in the figure refer to dates of banking crises in the sample countries and it seems that those are associated with a decrease in financial integration.


```{r plot_bank_gdp,fig.cap="Average real cross border bank claims \\label{plot_bank_gdp}",fig.height=5}

ggplot() + 
  labs(title = "Average bank linkages \n (real, normalized by gdp)",
       y = "", x = "") + 
  geom_line(fin_reg_df %>% 
              select(Date, bank_gdp) %>% 
              group_by(Date) %>% 
              summarise(Avg_bank = mean(bank_gdp,
                                        na.rm = TRUE)) %>% 
              ungroup() %>% 
              filter(complete.cases(.)),
            mapping = aes(x = Date, y = Avg_bank, group = 1)) + 
  geom_rect(data = raw_data$crises_df %>% 
              select(Start,End),
            mapping = aes(xmin = Start,xmax = End,
                          ymin = -Inf, ymax = Inf),
            fill = "lightgray", alpha = 0.1) +
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0,size = 7),
        axis.text.y = element_blank(),axis.ticks.y = element_blank(),
        legend.position = "bottom", plot.title = element_text(hjust = 0.5),
        axis.title.x = element_blank())


```


```{r plot_bank_gdp_strata,fig.cap="Average real cross border bank by claims country-pair group \\label{plot_bank_gdp_strata}",fig.height=3, eval=FALSE}

ggplot(fin_reg_df %>% 
         select(Date, CountryPair,Euro_both,bank_gdp) %>% 
         mutate(Euro_both = recode(
           Euro_both,
           "1" = "Euro",
           "0" = "Non Euro")) %>% 
         group_by(Date, Euro_both) %>% 
         summarise(avg_bank_gdp = mean(bank_gdp)),
       aes(x = Date, y = avg_bank_gdp, group = 1)) + 
  geom_line() + 
  labs(y = "", x = "") + 
  theme_bw() + 
  labs(title = "Bank linkages by country groups") + 
  theme(axis.ticks = element_blank(),
        axis.text = element_blank(),
        panel.grid = element_blank(), plot.title = element_text(hjust = 0.5)) + 
  facet_grid(~Euro_both)

```


```{r plot_average_cycle_synch,fig.cap="Average financial cycle synchronization \\label{plot_Fin_synch}",fig.pos="H"}

ggplot(fin_reg_df %>% 
         select(Date, Fin_synch) %>% 
         group_by(Date) %>% 
         summarise(Avg_Fin_synch = mean(Fin_synch, na.rm = TRUE)) %>% 
         ungroup() %>% 
         filter(complete.cases(.)) %>% 
         filter(is.finite(Avg_Fin_synch)),
       aes(x = Date, y = Avg_Fin_synch, group = 1)) + 
  labs(title = "Average financial cycle synchronization",y = "", x = "") + 
  geom_line() + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0),
        legend.position = "bottom", plot.title = element_text(hjust = 0.5))


```


Figure \ref{plot_bank_gdp_strata} shows the time trajectory of bank linkages (normalized by GDP) broken into Euro and Non Euro country-pairs groups. The plot shows that each group is characterized by its own trend: while Non Euro country pairs show a dramatic drop (probably as a result of GFC) the Euro country pairs are much more stable. In the regression analysis, I use the country-pair specific trend to account for this non-stationary behavior.

Figure \ref{plot_Fin_synch} shows the average synchronization (measured as the difference between credit and house price growth rates for each country-pair). The synchronization seems to be quite volatile with no specific trend until 2007-2008 (the global financial crises) and trending upward since. 


\section{Estimation and results} \label{results}


```{r output_reg, include=FALSE}

star = stargazer(reg_list$baseline, header = FALSE,digits = 2,
          label = "baseline",table.placement = "H",
          title = "Panel specification with controls",
          dep.var.caption = "Fin cycles synch",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects and country-pair ",
                                " specific linear time trend. ",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$baseline,cluster = "group")))),
          keep = paste0("^",temp_names,"$"),order = paste0("^",temp_names,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star,fixed = TRUE)

rm(temp_se_list, temp_reg_list)


```


```{r output_baseline_table, results="asis"}

cat(star,sep = "\n")

```


Estimation results are shown in table \ref{baseline}. Banking integration enters
the equation with a negative sign, meaning that integration is associated with less synchronized cycles. We can see that this effect is state dependend: the interaction terms suggest that during banking crises periods or in highly developed financial markets integration is associated with higher synchronization. This is also the case for culturaly similar countries : countries that share common language are associated with higher financial synchronization, and the interaction term suggest that banking integration in
those countries increases synchronization.

Coefficient analysis shows that the magnitude of the effect is quite modest.
A change of one percent in banking integration is associated with a change of `r abs(round(coef_vec[names(coef_vec) == "lag(bank_gdp, 1)"],2))` basis points in financial synchronization. During banking crises integration contributes `r abs(round(coef_vec[names(coef_vec) == "lag(bank_gdp, 1):Crises"],2))` basis points to the synchronization. In highly developed financial markets integration is associated with a `r abs(round(coef_vec[names(coef_vec) == "lag(bank_gdp, 1):FD_tot"],2))` basis points increase in synchronization.

\section{Robustness} \label{Robust}

\subsection{1978 - 2006 period}

In this section, I reduce my sample to the 1978-2006 period. That serves several purposes: first, it allows comparison between @Kalemli-Ozcan2013JF results with respect to business cycles synchronization and my results with respect to financial cycles synchronization. Second, this setting end before turmoil years that were characterized by the Global Financial Crises, the European sovereign debt crises, and their aftermaths and enables to estimate the association between banking integration and financial cycles synchronization during "normal" times. 


```{r output_reg_2006, include=FALSE}

star_2006 = stargazer(reg_list$before_2007, header = FALSE,digits = 2,
          label = "before_2007",table.placement = "H",
          title = "Panel specification with controls, before 2006",
          dep.var.caption = "Fin cycles synch",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects and country-pair ",
                                " specific linear time trend. ",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$before_2007,cluster = "group")))),
          keep = paste0("^",temp_names,"$"),order = paste0("^",temp_names,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star_2006 = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star_2006,fixed = TRUE)

```


```{r output_2006_table, results="asis"}

cat(star_2006,sep = "\n")

```


Table \ref{before_2007} present the results. The main results hold :  banking integration is associated with lower synchronization (`r abs(round(coef_vec_before_2007[names(coef_vec_before_2007) == "lag(bank_gdp, 1)"],2))` basis points reduction for a 1% change). The crisis and financial development effects work in the opposite direction (`r abs(round(coef_vec_before_2007[names(coef_vec_before_2007) == "lag(bank_gdp, 1):Crises"],2))` and `r abs(round(coef_vec_before_2007[names(coef_vec_before_2007) == "lag(bank_gdp, 1):FD_tot"],2))` respectively). The common language indicator enters the equation with the same sign but loses the statistical significance.


\subsection{Alternative measures of financial synchronization}


\section{Summary and conclusions} \label{conclusions}

This paper studies the effect of banking integration on the synchronization of financial cycles. There are opposite effects ("shock absorption" vs "shock propagation") that make the identification of this effect difficult. @Kalemli-Ozcan2013JF find that banking integration causes business cycles divergence, I find limited evidence of a negative association between banking integration and financial cycles synchronization. My results suggest that the relationship is state depended: I find that financial crises increase the "shock propagation" feature of banking integration. This is an important result for policymakers. It suggests that while banking integration may be desired, additional macroprudential measures may be warranted to account for the risk exposure during crisis times.


\newpage

\section{Appendix}

\subsection{Alternative empirical specifications}

\subsubsection{No trend}

In this section, I exclude the country-pair specific linear trend in order to test the robustness of my estimation. Table \ref{no_trend} presents the results.


```{r output_no_trend, include=FALSE}


star_no_trend = stargazer(reg_list$no_trend, header = FALSE,digits = 2,
          label = "no_trend",table.placement = "H",
          title = "Panel specification with controls, no trend",
          dep.var.caption = "Fin cycles synch",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects. ",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$no_trend,cluster = "group")))),
          keep = paste0("^",temp_names,"$"),order = paste0("^",temp_names,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star_no_trend = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star_no_trend,fixed = TRUE)


```


```{r output_no_trend_table, results="asis"}

cat(star_no_trend,sep = "\n")

```

\subsubsection{Credit}

```{r output_credit, include=FALSE}


star_credit = stargazer(reg_list$credit, header = FALSE,digits = 2,
          label = "credit",table.placement = "H",
          title = "Panel specification with controls, credit",
          dep.var.caption = "Credit cycles synchronization",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects and country-pair ",
                                " specific linear time trend. ",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$credit,cluster = "group")))),
          keep = paste0("^",temp_names,"$"),order = paste0("^",temp_names,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star_credit = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star_credit,fixed = TRUE)


```


```{r output_credit_table, results="asis"}

cat(star_credit,sep = "\n")

```

\subsubsection{House}

```{r output_house, include=FALSE}


star_house = stargazer(reg_list$house, header = FALSE,digits = 2,
          label = "house",table.placement = "H",
          title = "Panel specification with controls, house",
          dep.var.caption = "House cycles synchronization",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects and country-pair ",
                                " specific linear time trend. ",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$house,cluster = "group")))),
          keep = paste0("^",temp_names,"$"),order = paste0("^",temp_names,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star_house = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star_house,fixed = TRUE)


```


```{r output_house_table, results="asis"}

cat(star_house,sep = "\n")

```

\subsubsection{Lagged regression}

```{r output_reg_lag, include=FALSE}



star_lag = stargazer(reg_list$lag, header = FALSE,digits = 2,
          label = "lagged",table.placement = "H",
          title = "Panel specification with controls, lagged",
          dep.var.caption = "Fin cycles synch",
          model.numbers = FALSE,
          dep.var.labels.include = FALSE,
          notes = paste0("\\parbox[t]{8cm}{",
                         paste0("The table presents panel estimation that ",
                                "includes twoway fixed effects.",
                                "Financial cycles synchronization is the negative ",
                                "difference of financial cycles growth rates. ",
                                "Bank linkages is ",
                                "the cross border banking claims. ",
                                "Controls include foreign exchange ",
                                "stability, monetary independence, financial ",
                                "openness , trade linkages and GDP (log). ",
                                "The standard errors are clustered ",
                                "at country-pair level and ",
                                "heteroscedasticity robust."),
                         "}"),
          notes.align = "l",
          notes.append = FALSE,
          se = list(sqrt(diag(vcovHC(reg_list$lag,cluster = "group")))),
          column.sep.width = "1pt",
          keep = paste0("^",temp_names_lag,"$"),
          order = paste0("^",temp_names_lag,"$"),
          covariate.labels = temp_labels,
          omit.stat = c("f","adj.rsq"))

star_lag = sub("\\textit{Note:}  & \\multicolumn{1}{l}{\\parbox[t]{8cm}{",
                    "\\multicolumn{2}{l}{\\parbox[t]{10cm}{\\textit{Note:} ",
                    star_lag,fixed = TRUE)

```


```{r output_reg_lag_table, results="asis"}

cat(star_lag,sep = "\n")

```



<!-- \subsection{Delta estimation} -->

\subsection{Explanatory variables}

\textbf{Total credit}
Importantly, the data account for credit from all sources, not only that extended by domestic banks. Total credit from financial accounts, domestic bank credit, and cross-border bank credit are the three main building blocks underlying the construction of the total credit series. Trade credit (as well as other accounts payable and receivable) is excluded from the new total credit series because the quality of the underlying data is globally poor. In principle, nominal values are used for loans, corresponding to the origination price (historical cost) plus the interest that has accrued but not been paid if there has not been a default.  All other financial assets, including debt securities, are in principle valued at market prices. In practice, though, debt securities are often reported at nominal value. This may affect international comparability in cases of large volumes of debt securities and large price swings but is impossible to adjust for. As a rule, the total credit series are not adjusted for exchange rate movements. This correction is only possible for the international banking statistics where a currency breakdown is available but would be highly artificial for the long-run series.


\textbf{Property prices}
I use data about residential property prices (RPP) from BIS selected residential property prices data set. The selected residential property prices are harmonized as much as possible with recommendations in the Handbook on residential property prices, an internationally agreed framework for classifying property price issues.

\textbf{Bank linkages}
This variable is based on bilateral cross-border holdings (stocks) of banks. Data on banks’ cross-border bilateral stocks of assets and liabilities come from BIS’s Locational Banking Statistics. For each country-pair and year there are up to four observations: i) asset holdings (stocks) of banks located in country i in all sectors of the economy in country j, ii) asset holdings (stocks) of banks located in country j in all sectors of the economy in country i, iii) liabilities (stocks) of banks located in country i to country j, and iv) liabilities (stocks) of banks located in country j to country i. The data are originally expressed in (millions) current U.S. dollars. I normalize the data with the following steps:

\begin{enumerate}
  \item
  Deflate the four series with the U.S. CPI index
  
  \item
  Standardize the series by dividing assets and liabilities by the sum of the
two countries’ GDP in each year (using data from World Bank’s World
Development Indicators).

  \item
  Take the average of the log value of real bilateral assets and liabilities in each year.

\end{enumerate}


\textbf{Trading linkages} The measure is the log of bilateral real (deflated with the U.S. CPI) exports and imports as a share of the two countries’ GDP. Source: IMF Direction of Trade Database (2008).

\textbf{Monetary Independence},\textbf{Financial openness} and \textbf{Exchange Rate Stability} indices are based on the work of @Chinn2010.
  

\textbf{Exchange Rate Stability}

To measure exchange rate stability, annual standard deviations of the monthly exchange rate
between the home country and the base country are calculated and included in the following
formula to normalize the index between 0 and 1:

$ERS = \frac{0.01}{0.01 + SD(\Delta(log(FX)))}$

Merely applying this formula can easily create a downward bias in the index, that is, it would exaggerate the “flexibility” of the exchange rate especially when the rate usually follows a narrow band, but is de- or revalued infrequently.To avoid such downward bias, we a threshold to the exchange rate movement is applyed. That is, if the rate of
monthly change in the exchange rate stayed within +/-0.33 percent bands, the
exchange rate is considered “fixed” and the value of one is assigned for the ERS index. Furthermore, single year pegs are dropped because they are quite possibly not intentional ones. Higher values of this index indicate more stable movement of the exchange rate against the currency of the base country.


\textbf{Financial openness}

Financial openness measure is based on the index of capital account openness or KAOPEN, by @Chinn2006. KAOPEN is the first standardized principal component of the variables that indicate the presence of multiple exchange rates, restrictions on current account transactions, on capital account transactions, and the requirement of the surrender of export proceeds. The index is normalized between zero and one. Higher values of this index indicate that a country is more open to cross-border capital transactions.

\textbf{Monetary Independence}

The extent of monetary independence is measured as the reciprocal of the annual correlation
between the monthly interest rates of the home country and the base country.
The index for the extent of monetary independence is defined as:

\begin{equation*}
MI = 1 - \frac{corr(i_{i},i_{j}) - (-1)}{1 - (-1)}
\end{equation*}

where \textit{i} refers to home countries and \textit{j} to the base country. By construction, the maximum value is 1, and the minimum value is 0.
Higher values of the index mean more monetary policy independence


\textbf{GDP} - Source: World Development Index. Current US dollars

\section{Bibliography}


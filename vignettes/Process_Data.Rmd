
```{r load_libraries}

library(slider)

library(lubridate)

library(forcats)

```


<!-- Construct Country level data frame -->

```{r make_cycles_and_fin_synch_df}

cycles_df = preprocess_fin_cycle(raw_data,
                                 fin_cycle_comps = c("house_price",
                                                     "share_price"))

fin_synch_df = preprocess_synch_df(cycles_df)

```

```{r banking_linkages}

bank_link = preprocess_lbs_data(raw_data,deflate_data = FALSE)

```

```{r crises_dates}

crises_df = preprocess_crisis_dates(raw_data)

```

```{r trade_linkages}

trade_link = preprocess_imf_trade_data(raw_data, deflate_data = FALSE)

```

```{r financial_development}

fin_dev_df = preprocess_fin_dev(raw_data)

```

```{r euro_membership}

euro_membership_df = calculate_euro_membership(raw_data)

```

```{r controls}

controls_df = preprocess_controls(raw_data)

```

```{r join_to_country_pair_df}

country_pair_df = list(fin_synch_df, bank_link, trade_link,
                       crises_df,fin_dev_df, controls_df,
                       euro_membership_df) %>% 
  reduce(full_join, by = c("country_pair","year"))

country_pair_df = country_pair_df %>% 
  filter(is.finite(trade_gdp)) %>% 
  mutate(gdp_usd = gdp_usd * 10 ^ -6)

country_pair_df = country_pair_df %>% 
  group_by(country_pair) %>% 
  arrange(year) %>% 
  fill(euro_member,.direction = "down") %>% 
  mutate(euro_member = replace_na(euro_member,0)) %>% 
  ungroup()


country_pair_df = country_pair_df %>% 
  group_by(country_pair) %>% 
  mutate(time_trend = seq_along(year)) %>% 
  ungroup()

rm(list = ls()[!ls()%in% c("country_pair_df","raw_data")])

```



```{r load_libraries}

library(lubridate)

```


<!-- Construct Country level data frame -->

```{r make_cycles_and_fin_synch_df}

cycles_df = preprocess_fin_cycle(raw_data)

fin_synch_df = preprocess_synch_df(cycles_df)

```

```{r banking_linkages}

bank_link = preprocess_lbs_data(raw_data,deflate_data = FALSE)

```

```{r crises_dates}

crises_df = preprocess_crisis_dates(raw_data)

```

```{r trade_linkages}

trade_link = preprocess_imf_trade_data(raw_data, deflate_data = FALSE)

```

```{r financial_development}

fin_dev_df = preprocess_fin_dev(raw_data)

```

```{r controls}

controls_df = preprocess_controls(raw_data)

```

```{r join_to_country_pair_df}

country_pair_df = list(fin_synch_df, bank_link, trade_link,
                       crises_df,fin_dev_df, controls_df) %>% 
  reduce(full_join, by = c("country_pair","year")) %>% 
  mutate(across(c("crisis_ind", "fo_ind"), ~replace_na(.,0)))

country_pair_df = country_pair_df %>% 
  filter(complete.cases(.)) %>% 
  filter(is.finite(trade_gdp)) %>% 
  mutate(gdp_usd = gdp_usd * 10 ^ -6)

country_pair_df = country_pair_df %>% 
  group_by(country_pair) %>% 
  arrange(year) %>% 
  mutate(time_trend = 1:length(country_pair)) %>% 
  ungroup()

# rm(list = ls()[!ls()%in% c("country_pair_df","raw_data")])

```

```{r filter_country_pair}

temp_fin_reg = read_rds("C:\\Users\\internet\\Desktop\\temp_fin_reg.rds")

temp_fin_reg = temp_fin_reg %>% 
  select(year = Date, country_pair = CountryPair,
         bank_gdp, trade_gdp, Crises, FX_stab_tot, FO_ind_tot,
         Fin_synch, FD_tot) %>% 
  filter(complete.cases(.))


temp_fin_reg %>% 
  anti_join(country_pair_df, by = c("country_pair","year")) %>% 
  distinct()

country_pair_df = country_pair_df %>% 
  inner_join(temp_bank_gdp, by = c("country_pair","year")) %>% 
  filter(year >= 1980 & year <= 2013)

```


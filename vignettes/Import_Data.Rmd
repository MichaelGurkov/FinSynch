
<!-- Import raw data -->

```{r Import_raw_data}

raw_data = list()

raw_data$oecd_codes = read.csv(paste0(
  file.path(Sys.getenv("USERPROFILE"),fsep ="\\"),
  "\\OneDrive - Bank Of Israel\\Data\\ISO\\",
  "iso_3digit_alpha_country","_codes.csv" ),
  stringsAsFactors = FALSE) %>%
  setNames(c("Code","Country")) %>% 
  mutate(Country = gsub(Country,pattern = "\\s",
      replacement = "_")) %>% 
  mutate(Country = sub(Country,pattern = "Korea,_Republic_of",
      replacement = "Korea", fixed = TRUE)) %>% 
  mutate(Country = sub(Country,pattern = "Czechia",
      replacement = "Czech_Republic", fixed = TRUE)) %>% 
  mutate(Country = sub(Country,pattern = "Slovakia",
      replacement = "Slovak_Republic", fixed = TRUE)) %>% 
  mutate(Country = sub("The_Netherlands","Netherlands",
                       Country,fixed = TRUE))

raw_data$TotalCredit = import.bis.tot.credit.data(
  countries_vec = countries_list$oecd_countries) %>%
  mutate(Date = as.yearqtr(Date, format = "%Y-Q%q"))

raw_data$bis_lbs = import.bis.lbs.data(
  countries_vec = countries_list$oecd_countries) %>%
  mutate(Date = as.yearqtr(Date, format = "%Y-Q%q"))

raw_data$GDP_constant = import.wdi.gdp(
  filepath = paste0(
    file.path(Sys.getenv("USERPROFILE"),fsep = "\\"),
    "\\OneDrive - Bank Of Israel\\Data\\World ",
    "Bank\\API_NY.GDP.MKTP.KD_DS2_en_csv_v2_316073.csv"),
  message_gdp_type = FALSE,
  countries_codes = raw_data$oecd_codes %>%
    filter(Country %in% countries_list$oecd_countries) %>% 
    select(Code) %>% 
    unlist()) %>% 
  mutate(GDP = GDP * 10 ^ (-6)) %>% 
  mutate(Country = gsub("\\s","_",Country))

raw_data$GDP_current = import.wdi.gdp(
  filepath = paste0(
    file.path(Sys.getenv("USERPROFILE"),fsep = "\\"),
    "\\OneDrive - Bank Of Israel\\Data\\World ",
    "Bank\\API_NY.GDP.MKTP.CD_DS2_en_csv_v2_315857.csv"),
  message_gdp_type = FALSE,
  countries_codes = raw_data$oecd_codes %>%
    filter(Country %in% countries_list$oecd_countries) %>% 
    select(Code) %>% 
    unlist()) %>% 
  mutate(GDP = GDP * 10 ^ (-6)) %>% 
  mutate(Country = gsub("\\s","_",Country))

raw_data$HousePrice = import.oecd.houseprice() %>% 
  rename(Code = Country) %>% 
  left_join(raw_data$oecd_codes, by = "Code") %>% 
  select(-Code) %>% 
  select(Country, Date, HousePrice)


raw_data$SharePrice = import.oecd.shareprice() %>% 
  rename(Code = Country) %>% 
  left_join(raw_data$oecd_codes, by = "Code") %>% 
  select(-Code) %>% 
  select(Country, Date, SharePrice)


raw_data$cpi = import.bis.cpi.data(annual_freq = FALSE) %>% 
  mutate(Date = as.yearqtr(Date, format = "%Y.%m")) %>% 
  group_by(Date) %>% 
  summarise(US_CPI = mean(US_CPI)) %>% 
  ungroup()



```


```{r Import_raw_data_EU_membership}

eu_df = read.csv(paste0(
  file.path(Sys.getenv("USERPROFILE"),fsep = "\\"),
  "\\OneDrive - Bank Of Israel\\Data\\Misc\\EU_membership.csv"),
                 stringsAsFactors = FALSE) %>%
  setNames(c("Country","Euro_area","EU")) %>%
  mutate(Country = gsub("\\s","_",Country)) %>%
  mutate(Country = sub("The_Netherlands","Netherlands",
                       Country,fixed = TRUE)) %>%
  mutate(Country = sub("Slovakia","Slovak_Republic",
                       Country,fixed = TRUE))


eu_dates_vec = seq.Date(
  from = as.Date(min(raw_data$bis_lbs$Date)),
  to = as.Date(max(raw_data$bis_lbs$Date)),
  by = "year") %>%
  format(.,"%Y")

raw_data$EU_both = construct_countrypair_EU_index(
  eu_df = eu_df %>%
    select(Country, EU) %>%
    rename(Date = EU),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries) %>%
  rename(EU_both = Status) %>%
  mutate(Date = as.character(Date))

raw_data$EU_one = construct_countrypair_EU_index(
  eu_df = eu_df %>%
    select(Country, EU) %>%
    rename(Date = EU),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries,
  index_status = "one") %>%
  rename(EU_one = Status) %>%
  mutate(Date = as.character(Date))


raw_data$Euro_both = construct_countrypair_EU_index(
  eu_df = eu_df %>%
    select(Country, Euro_area) %>%
    rename(Date = Euro_area) %>%
    filter(!Date == "Not a member"),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries) %>%
  rename(Euro_both = Status) %>%
  mutate(Date = as.character(Date))

raw_data$Euro_one = construct_countrypair_EU_index(
  eu_df = eu_df %>%
    select(Country, Euro_area) %>%
    rename(Date = Euro_area),
  dates_vec = eu_dates_vec,
  countries = countries_list$oecd_countries,
  index_status = "one") %>%
  rename(Euro_one = Status) %>%
  mutate(Date = as.character(Date))

rm(eu_df, eu_dates_vec)

```


```{r Import_raw_data_common_language}

raw_data$geodist = import.geodist.data() %>%
  filter(Country %in% countries_list$oecd_countries) %>%
  filter(Counter_Country %in% countries_list$oecd_countries) %>%
  mutate(CountryPair = ifelse(Country < Counter_Country,
                              paste(Country, Counter_Country,
                                    sep = "-"),
                              paste(Counter_Country,Country,
                                    sep = "-"))) %>%
  select(-Country, -Counter_Country) %>%
  distinct()

```


```{r Import_raw_data_crises_dates}

raw_data$crises_df =  import.crises.dates.df(countries_vec = countries_list$oecd_countries)

```


```{r Import_raw_data_IMF}

raw_data$trade = import.imf.trade.data()

```


```{r Import_raw_data_trilemma}

raw_data$trilemma_data = import.trilemma.ind()

```


```{r Import_fin_dev_data}

raw_data$fin_dev_data = import.fin.dev.ind()

```

